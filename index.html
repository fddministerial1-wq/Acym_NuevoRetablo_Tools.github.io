<script src="https://unpkg.com/html5-qrcode"></script>

<div style="text-align: center; padding: 20px;">
    <button id="btn-permiso" style="padding: 15px 30px; font-size: 18px; cursor: pointer; background: #28a745; color: white; border: none; border-radius: 5px;">
        Habilitar C치mara y Escanear
    </button>
    <div id="reader" style="width: 100%; max-width: 500px; margin: 20px auto;"></div>
    <div id="scanned-result" style="margin-top: 20px; font-weight: bold;"></div>
</div>

<script>
    const html5QrCode = new Html5Qrcode("reader");
    
    document.getElementById('btn-permiso').addEventListener('click', async () => {
        try {
            // Forzamos la petici칩n de permiso antes de iniciar el lector
            await navigator.mediaDevices.getUserMedia({ video: true });
            
            document.getElementById('btn-permiso').style.display = 'none';
            
            html5QrCode.start(
                { facingMode: "environment" }, 
                { fps: 10, qrbox: { width: 250, height: 250 } },
                (text) => {
                    document.getElementById('scanned-result').innerHTML = `C칩digo: <a href="${text}">${text}</a>`;
                }
            ).catch(e => alert("Error al iniciar: " + e));
            
        } catch (err) {
            alert("No se pudo acceder a la c치mara. Por favor, revisa los permisos de tu navegador: " + err);
        }
    });
</script>
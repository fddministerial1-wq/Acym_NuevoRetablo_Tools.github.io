<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lector QR v1.5</title>
    <script src="https://unpkg.com/html5-qrcode"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 100vh; margin: 0; background: transparent; }
        /* Forzamos que el lector ocupe el espacio disponible */
        #reader { width: 100%; max-width: 400px; min-height: 300px; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.2); background: #000; }
        .btn-scan { padding: 16px 32px; background: #00008B; color: white; border: none; border-radius: 50px; font-weight: bold; cursor: pointer; font-size: 16px; margin-bottom: 10px; }
        #result { margin-top: 15px; padding: 12px; width: 85%; text-align: center; background: white; border-radius: 8px; border: 1px solid #ddd; word-break: break-all; }
        .version { margin-top: 15px; font-size: 10px; color: #888; background: #fff; padding: 2px 8px; border-radius: 10px; border: 1px solid #eee; }
    </style>
</head>
<body>

    <button id="start-btn" class="btn-scan">ACTIVAR CÁMARA</button>
    
    <div id="reader" style="display:none;"></div>
    
    <div id="result">Presione el botón para escanear asistencia</div>
    
    <div class="version">v1.5 - Acym Nuevo Retablo</div>

    <script>
        const resultDiv = document.getElementById('result');
        const startBtn = document.getElementById('start-btn');
        const readerDiv = document.getElementById('reader');

        // Configuración para forzar visibilidad en iframes (Google Sites)
        const html5QrCode = new Html5Qrcode("reader", { verbose: false });

        startBtn.onclick = () => {
            startBtn.style.display = 'none';
            readerDiv.style.display = 'block';
            resultDiv.innerText = "Iniciando transmisión...";

            const qrConfig = { 
                fps: 15, 
                qrbox: { width: 250, height: 250 },
                aspectRatio: 1.0
            };

            // Intentamos iniciar con la cámara trasera (environment)
            html5QrCode.start(
                { facingMode: "environment" }, 
                qrConfig,
                (decodedText) => {
                    resultDiv.innerHTML = `<b style="color:green;">¡Escaneado!</b><br><a href="${decodedText}" target="_blank">${decodedText}</a>`;
                    // Opcional: Sonido o vibración aquí
                }
            ).catch(err => {
                console.error(err);
                // Si falla la trasera (ej. en PC), intentamos con cualquier cámara disponible
                html5QrCode.start({ facingMode: "user" }, qrConfig, (text) => {
                    resultDiv.innerHTML = `<b>Resultado:</b> ${text}`;
                }).catch(err2 => {
                    resultDiv.innerHTML = `<b style="color:red;">Error de visualización:</b> Asegúrate de que el cuadro en Google Sites sea grande.`;
                    startBtn.style.display = 'block';
                    startBtn.innerText = "REINTENTAR";
                });
            });
        };
    </script>
</body>
</html>